<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Gastos</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">

<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 min-h-screen">

<div class="max-w-6xl mx-auto p-4 sm:p-6">

    <h1 class="text-2xl sm:text-3xl font-bold text-center text-blue-600 mb-6">
        ðŸ’° Sistema de Gastos
    </h1>

    <!-- Formulario -->
    <div class="bg-white rounded-xl shadow-md p-4 sm:p-6 mb-6">
        <form id="gastoForm" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3">

            <input type="date" id="fecha" required
                class="border rounded-xl p-3 text-base w-full focus:outline-none focus:ring-2 focus:ring-blue-400">

            <input type="text" id="descripcion" placeholder="DescripciÃ³n" required
                class="border rounded-xl p-3 text-base w-full focus:outline-none focus:ring-2 focus:ring-blue-400">

            <input type="number" id="monto" placeholder="Monto" step="0.01" required
                class="border rounded-xl p-3 text-base w-full focus:outline-none focus:ring-2 focus:ring-blue-400">

            <select id="categoria"
                class="border rounded-xl p-3 text-base w-full focus:outline-none focus:ring-2 focus:ring-blue-400">
                <option value="Personal">Personal</option>
                <option value="General">General</option>
            </select>

            <button type="submit"
                class="bg-blue-600 text-white rounded-xl py-3 text-lg font-semibold active:scale-95 transition">
                Agregar
            </button>

        </form>
    </div>

    <!-- Filtro -->
    <div class="flex flex-col sm:flex-row gap-3 sm:items-center mb-4">
        <label class="font-semibold">Filtrar por mes:</label>
        <input type="month" id="filtroMes"
            class="border rounded-xl p-3 text-base focus:outline-none focus:ring-2 focus:ring-blue-400">

        <button onclick="limpiarFiltro()"
            class="bg-gray-500 text-white px-4 py-3 rounded-xl active:scale-95">
            Todos
        </button>
    </div>

    <!-- Tabla -->
    <div class="bg-white rounded-xl shadow-md overflow-x-auto text-sm">
        <table class="w-full text-sm sm:text-base text-center">
            <thead class="bg-blue-600 text-white">
                <tr>
                    <th class="p-3">Fecha</th>
                    <th class="p-3">DescripciÃ³n</th>
                    <th class="p-3">Monto</th>
                    <th class="p-3">CategorÃ­a</th>
                    <th class="p-3">Eliminar</th>
                </tr>
            </thead>
            <tbody id="listaGastos" class="divide-y"></tbody>
        </table>
    </div>

    <!-- Totales -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mt-6 text-white font-bold text-lg">
        <div class="bg-green-500 p-4 rounded-xl text-center">
            Personal: $<span id="totalPersonal">0.00</span>
        </div>

        <div class="bg-red-500 p-4 rounded-xl text-center">
            General: $<span id="totalGeneral">0.00</span>
        </div>

        <div class="bg-blue-600 p-4 rounded-xl text-center">
            Total: $<span id="totalGlobal">0.00</span>
        </div>
    </div>

</div>

<script>
let gastos = JSON.parse(localStorage.getItem("gastos")) ?? [];

const form = document.getElementById("gastoForm");
const lista = document.getElementById("listaGastos");
const filtroMes = document.getElementById("filtroMes");

form.addEventListener("submit", function(e) {
    e.preventDefault();

    const gasto = {
        id: Date.now(),
        fecha: document.getElementById("fecha").value,
        descripcion: document.getElementById("descripcion").value,
        monto: parseFloat(document.getElementById("monto").value),
        categoria: document.getElementById("categoria").value
    };

    gastos.push(gasto);
    guardar();
    mostrar();
    form.reset();
});

filtroMes.addEventListener("change", mostrar);

function mostrar() {
    lista.innerHTML = "";
    let totalPersonal = 0;
    let totalGeneral = 0;

    const mesSeleccionado = filtroMes.value;

    gastos.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

    gastos.forEach((gasto) => {

        if (mesSeleccionado && !gasto.fecha.startsWith(mesSeleccionado)) {
            return;
        }

        const fila = `
            <tr class="hover:bg-slate-100">
                <td class="p-3">${gasto.fecha}</td>
                <td class="p-3">${gasto.descripcion}</td>
                <td class="p-3 font-semibold">$${gasto.monto.toFixed(2)}</td>
                <td class="p-3">${gasto.categoria}</td>
                <td class="p-3">
                    <button onclick="eliminar(${gasto.id})"
                        class="bg-red-500 text-white px-4 py-2 rounded-xl active:scale-95">
                        X
                    </button>
                </td>
            </tr>
        `;
        lista.innerHTML += fila;

        if (gasto.categoria === "Personal") {
            totalPersonal += gasto.monto;
        } else {
            totalGeneral += gasto.monto;
        }
    });

    document.getElementById("totalPersonal").textContent = totalPersonal.toFixed(2);
    document.getElementById("totalGeneral").textContent = totalGeneral.toFixed(2);
    document.getElementById("totalGlobal").textContent = (totalPersonal + totalGeneral).toFixed(2);
}

function eliminar(id) {
    gastos = gastos.filter(gasto => gasto.id !== id);
    guardar();
    mostrar();
}

function guardar() {
    localStorage.setItem("gastos", JSON.stringify(gastos));
}

function limpiarFiltro() {
    filtroMes.value = "";
    mostrar();
}

mostrar();

if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("sw.js");
  });
}
</script>

</body>
</html>